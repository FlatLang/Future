package flat/future

import flat/thread
import flat/time

testable class {
  async test `Future.from: can delay the execution of the future`() {
    let start = Time.currentTimeMillis

    let future = Future.from(async {
      Thread.sleep(100)
      return "hey"
    })

    let end = Time.currentTimeMillis
    let response = await future.get()

    expect(end - start < 90).toBe(true)
    expect(response).toBe("hey")
  }

  async test `Future.from: can wait for the execution of the future`() {
    let start = Time.currentTimeMillis

    let future = Future.from(async {
      Thread.sleep(100)
      return "hey"
    })

    let response = await future.get()
    let end = Time.currentTimeMillis

    expect(end - start >= 90).toBe(true)
    expect(response).toBe("hey")
  }

  async test `Future.fromResolve: can delay the execution of the future`() {
    let start = Time.currentTimeMillis

    let future = Future.fromResolve(async {
      Thread.sleep(100)
      _resolve("hey")
    })

    let end = Time.currentTimeMillis
    let response = await future.get()

    expect(end - start < 90).toBe(true)
    expect(response).toBe("hey")
  }

  async test `Future.fromResolve: can wait for the execution of the future`() {
    let start = Time.currentTimeMillis

    let future = Future.fromResolve(async {
      Thread.sleep(100)
      _resolve("hey")
    })

    let response = await future.get()
    let end = Time.currentTimeMillis

    expect(end - start >= 90).toBe(true)
    expect(response).toBe("hey")
  }
}
